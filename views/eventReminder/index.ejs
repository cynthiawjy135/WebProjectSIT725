
<%- include('../components/header', { title: 'Event Reminder' , user }) %>
   <div class="calendar-container">
        <div class="row">
            <div id='calendar'></div>
        </div>
    </div>

    <%- include('../eventReminder/eventmodal') %>

<%- include('../components/footer') %>

<script>
       document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.modal');
        var instances = M.Modal.init(elems);

        // fetch('/api/eventReminder')
        //     .then(response => response.text()) //get raw response instead of JSON
        //     .then(text => console.log("Raw Response:", text)) //log raw response
        //     .catch(error => console.error('Fetch Error:', error));

        var calendarEl = document.getElementById('calendar');
        window.calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            select: function(info) { //when selecting a date
                var modal = M.Modal.getInstance(document.getElementById('modal1'));
                modal.open();
                document.getElementById('event_start_date').value = info.startStr;
                document.getElementById('event_end_date').value = info.startStr;
            },
            eventClick: function(info) { //when deleting an event
                if (confirm("Delete this event?")) {
                    const eventIds = [info.event.id]; // Try '_id' if your event object has it

                    console.log("Attempting to delete event:", eventIds); //Log the request before sending

                    fetch("/api/eventReminder/bulk-delete", {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ eventIds }) // Send event IDs correctly
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log("Deletion Response:", data);
                        if (data.deletedCount > 0) {
                            info.event.remove(); // Remove from FullCalendar UI
                        } else {
                            console.error("No events were deleted.");
                        }
                    })
                    .catch(error => console.error("Delete error:", error));
                }
            },
            events: '/api/eventReminder',
            editable: true,
            dayMaxEvents: true, //allow "more" link when too many events
            });
        calendar.render();
    });
</script>

<style>
    :root {
        --fc-small-font-size: .85em;
        --fc-page-bg-color: var(--bgcolor);
        --fc-neutral-bg-color: rgba(148, 53, 53, 0.3);
        --fc-neutral-text-color: #951515;
        --fc-border-color: var(--main-color);

        --fc-button-text-color: #fff;
        --fc-button-bg-color: var(--main-color);
        --fc-button-border-color: #541111;
        --fc-button-hover-bg-color: #4b0606;
        --fc-button-hover-border-color: #4b1414;
        --fc-button-active-bg-color: #4b0606;
        --fc-button-active-border-color: #4b1414;

        --fc-list-event-dot-width: 10px;
        --fc-list-event-hover-bg-color: rgba(255, 94, 49, 0.269);

        --fc-event-bg-color: #951515;
        --fc-event-border-color: #951515;
        --fc-event-text-color: #fae6e6;
        --fc-event-selected-overlay-color: rgb(255, 0, 0);

        --fc-more-link-bg-color: #bb3a3a;
        --fc-more-link-text-color: #951515;

        --fc-event-resizer-thickness: 8px;
        --fc-event-resizer-dot-total-width: 8px;
        --fc-event-resizer-dot-border-width: 1px;

        --fc-non-business-color: rgb(215, 215, 215);
        --fc-bg-event-color: rgb(255, 225, 0);
        --fc-bg-event-opacity: 1;
        --fc-highlight-color: rgba(255, 55, 0, 0.429);
        --fc-today-bg-color: var(--soft-pink);
        --fc-now-indicator-color: red;
    }

    .calendar-container {
        background-color: var(--secondary-color);
        text-align: center;
        height: 100%;
        overflow: auto;
        padding: 5%;
    }


    .title {
        font-size: 36px;
    }
</style>

